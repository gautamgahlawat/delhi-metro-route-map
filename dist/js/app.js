/*! delhi-tourist-spots-map 07-02-2017 */
function initMap(){map=new google.maps.Map(document.getElementsByClassName("map")[0],{zoomControl:!0}),window.mapBounds=new google.maps.LatLngBounds,infoWindow=new google.maps.InfoWindow({maxWidth:250}),createMarkers(Model.touristPlaces),vmodel=new viewModel,ko.applyBindings(vmodel)}function createMarkers(a){var b,c,d,e=a.length;for(c=0;c<e;c++)b=a[c],getWikiInfo(b,c),d=window.mapBounds,marker=new google.maps.Marker({position:b.location,animation:google.maps.Animation.DROP,map:map,title:b.name}),marker.addListener("click",function(a){return function(){!function(a){Model.currentPlace=a}(a),toggleBounce(),showInfoWindow()}}(b)),google.maps.event.addListener(infoWindow,"closeclick",function(){toggleBounce(),vmodel.activeListItemIndex(null)}),d.extend(new google.maps.LatLng(b.location.lat,b.location.lng)),map.fitBounds(d),map.setCenter(d.getCenter()),markers.push(marker)}var map,infoWindow,markers=ko.observableArray(),vmodel,Model={currentPlace:null,touristPlaces:[{name:"Purana Qila",location:{lat:28.609579,lng:77.243736},wiki:null},{name:"India Gate",location:{lat:28.612913,lng:77.229509},wiki:null},{name:"Humayun Tomb",location:{lat:28.59334,lng:77.25071},wiki:null},{name:"Lotus Temple",location:{lat:28.553503,lng:77.258821},wiki:null},{name:"Qutub Minar",location:{lat:28.524511,lng:77.185307},wiki:null},{name:"Red Fort",location:{lat:28.656173,lng:77.241011},wiki:null},{name:"India Habitat Centre",location:{lat:28.589948,lng:77.225132},wiki:null},{name:"Gurudwara Bangla Sahib",location:{lat:28.626419,lng:77.208996},wiki:null},{name:"Jama Masjid",location:{lat:28.650675,lng:77.233372},wiki:null},{name:"Raj Ghat",location:{lat:28.640732,lng:77.249508},wiki:null},{name:"National Rail Museum",location:{lat:28.585502,lng:77.180071},wiki:null},{name:"Jantar Mantar",location:{lat:28.627097,lng:77.216549},wiki:null}]},getWikiInfo=function(a,b){var c="https://en.wikipedia.org/w/api.php?action=opensearch&search="+a.name+"&format=json",d=setTimeout(function(){0===b&&alert("Unable to Load Information from wikipedia")},8e3);$.ajax({url:c,dataType:"jsonp",success:function(a){Model.touristPlaces[b].wiki=a[2][0],clearTimeout(d)}})};showInfoWindow=function(){var a=Model.currentPlace,b=Model.touristPlaces.indexOf(a),c='<div class="info-window">';c+="<h4>"+a.name+"</h4>",c+=null===a.wiki?"<p>Sorry! Unable to load wikipedia information</p>":"<p>"+a.wiki+"</p>",vmodel.activeListItemIndex(b),infoWindow.setContent(c),map.panTo(a.location),infoWindow.open(map,markers()[b])};var toggleBounce=function(){var a=Model.touristPlaces.indexOf(Model.currentPlace),b=markers()[a];markers().forEach(function(b,c){a!==c&&b.setAnimation(null)}),null!==b.getAnimation()?(b.setAnimation(null),infoWindow.close(),vmodel.activeListItemIndex(null)):b.setAnimation(google.maps.Animation.BOUNCE)};window.addEventListener("resize",function(a){map.fitBounds(mapBounds)});var viewModel=function(){var a=this;a.menuStatus=ko.observable(!1),a.activeListItemIndex=ko.observable(null),a.places=ko.observableArray(Model.touristPlaces),a.filterText=ko.observable(""),a.toggleMenu=ko.pureComputed(function(){return 0==a.menuStatus()?"menu-hidden":""}),a.showInfoWindowWhenClicked=function(b){Model.currentPlace=b;var c=Model.touristPlaces.indexOf(b);null===a.activeListItemIndex()||a.activeListItemIndex()!==c?(a.activeListItemIndex(c),showInfoWindow()):a.activeListItemIndex()===c&&(a.activeListItemIndex(null),infoWindow.close()),toggleBounce()},a.filter=ko.computed(function(){infoWindow.close(),a.activeListItemIndex(null),markers().forEach(function(a){a.visible||a.setVisible(!0)});var b,c,d=ko.utils.arrayFilter(a.places(),function(b){return b.name.toLowerCase().indexOf(a.filterText().toLowerCase())==-1});return d.forEach(function(a){b=Model.touristPlaces.indexOf(a),c=markers()[b],c.setVisible(!1)}),ko.utils.arrayFilter(a.places(),function(b){return b.name.toLowerCase().indexOf(a.filterText().toLowerCase())>=0})})};